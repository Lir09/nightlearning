<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TMFD - 야자관리</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;800&family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#2e7d32; --red:#c62828;
      --line:#cfcfcf; --title:#5b82d8;
      --aisle:24px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Noto Sans KR','Inter',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:#111;background:#fff}
    .page{max-width:1000px;margin:24px auto 48px;padding:0 16px;border:2px solid #111;border-radius:4px}
    .head{text-align:center;padding-top:8px}
    .slogan{margin:16px 0 6px;font-weight:700;font-size:32px;color:var(--title)}
    .klass{font-size:32px;font-weight:800;margin:0 0 10px}
    .desk-teacher{display:inline-block;padding:10px 40px;border:2px solid #888;border-radius:4px;margin:6px auto 14px;font-weight:700;background:#fff}
    .layout{display:grid;grid-template-columns:1fr 100px;gap:20px;align-items:start;padding:0 24px 24px}
    .hall{border:1.8px solid #111;border-radius:4px;height:560px;display:flex;align-items:center;justify-content:center;background:#fff}
    .hall .label{writing-mode:vertical-rl;font-size:22px;font-weight:700;letter-spacing:.15em}
    .rows{display:grid;row-gap:8px;justify-items:center}
    .row{display:grid;grid-template-columns:repeat(3, minmax(200px, 1fr));column-gap:var(--aisle);width:100%;max-width:720px}
    .pair{display:grid;grid-template-columns:1fr 1fr;}
    .cell{border:1px solid var(--line);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;height:90px;background:#fff;padding-top:4px}
    .reason{font-size:12px;color:#444;min-height:16px;margin-bottom:4px}
    .name{appearance:none;border:0;background:transparent;cursor:pointer;font:600 16px/1.3 'Noto Sans KR',sans-serif;color:var(--green);padding:2px 6px;border-radius:6px;transition:transform .05s ease;margin-top:2px}
    .name:active{transform:scale(.98)}
    .name.selected{color:var(--red)}
    .id{font-size:13px;color:#555;margin-top:2px}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.45);align-items:center;justify-content:center;z-index:1000}
    .modal-content{background:#fff;padding:20px 24px;border-radius:8px;max-width:320px;width:90%;text-align:center}
    .modal-content h2{margin:0 0 12px;font-size:18px}
    .modal-content input{width:100%;padding:8px;font-size:14px;margin-bottom:12px}
    .modal-content button{margin:0 6px;padding:6px 14px;font-size:14px;border:none;border-radius:6px;cursor:pointer}
    .save-btn{background:#2e7d32;color:#fff}
    .cancel-btn{background:#ccc}
    .cip-result{font-size:10px;color:#444;margin-top:2px}
    .cip-group{margin:10px 0;display:flex;flex-direction:column;gap:8px;align-items:flex-start;width:100%}
    .cip-row{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid #e6e6e6;border-radius:10px;width:100%;background:#fff;cursor:pointer}
    .cip-row input{width:18px;height:18px;margin:0;accent-color:#2e7d32}
    .cip-row span{font-size:14px;color:#333;white-space:nowrap}
    @media (max-width:760px){
      .layout{grid-template-columns:1fr 80px}
      .row{grid-template-columns:repeat(3, minmax(160px,1fr))}
      .cell{height:80px}
      .hall{height:520px}
    }
    a {
  text-decoration: none;
}
  </style>
</head>
<body>
  <div class="page">
    <div class="head">
      <a href=./index.html class="slogan">불꽃 열정 포기하지 말자!!</a>
      <h1 class="klass">1학년 8반</h1>
      <div class="desk-teacher">교&nbsp;탁</div>
    </div>

    <div class="layout">
      <section class="rows" id="rows">
        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">박경록</button>
              <div class="id">10813</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">고동민</button>
              <div class="id">10101</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">장해찬</button>
              <div class="id">10830</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이선준</button>
              <div class="id">10824</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">오태진</button>
              <div class="id">10820</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김민서</button>
              <div class="id">10806</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이재성</button>
              <div class="id">10826</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이종혁</button>
              <div class="id">10837</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">신민호</button>
              <div class="id">10819</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">송재호</button>
              <div class="id">10818</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김선준</button>
              <div class="id">10807</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김다원</button>
              <div class="id">10803</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이인수</button>
              <div class="id">10825</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">황인환</button>
              <div class="id">10836</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">민경한</button>
              <div class="id">10811</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">방지우</button>
              <div class="id">10816</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">조현빈</button>
              <div class="id">10832</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">허원</button>
              <div class="id">10834</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">한상휘</button>
              <div class="id">10833</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">전윤우</button>
              <div class="id">10831</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">박현규</button>
              <div class="id">10815</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">장재민</button>
              <div class="id">10829</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이건희</button>
              <div class="id">10823</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김지후</button>
              <div class="id">10809</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김가빈</button>
              <div class="id">10802</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이지상</button>
              <div class="id">10827</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김태환</button>
              <div class="id">10810</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">윤하유</button>
              <div class="id">10822</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">박건호</button>
              <div class="id">10812</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김지효</button>
              <div class="id">10808</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김도현</button>
              <div class="id">10804</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <button class="name">황동규</button>
              <div class="id">10835</div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">이진규</button>
              <div class="id">10828</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">손주형</button>
              <div class="id">10817</div>
              <div class="cip-result"></div>
            </div>
          </div>
          <div class="pair">
            <div class="cell">
              <div class="reason"></div>
              <button class="name">김민범</button>
              <div class="id">10805</div>
              <div class="cip-result"></div>
            </div>
            <div class="cell">
              <div class="reason"></div>
              <button class="name">박민규</button>
              <div class="id">10814</div>
              <div class="cip-result"></div>
            </div>
          </div>
        </div>
      </section>

      <aside class="hall" id="hall">
        <div class="label">복도</div>
      </aside>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modal-content">
      <h2>사유 입력 (최대 8자)</h2>
      <input type="text" id="reasonInput" maxlength="8" placeholder="사유를 입력하세요"/>
      <div class="cip-group">
        <label class="cip-row">
          <input type="checkbox" class="cip" value="1차"><span>1차</span>
        </label>
        <label class="cip-row">
          <input type="checkbox" class="cip" value="2차"><span>2차</span>
        </label>
        <label class="cip-row">
          <input type="checkbox" class="cip" value="3차"><span>3차</span>
        </label>
      </div>
      <div style="text-align:center;margin-top:10px">
        <button class="save-btn">저장</button>
      </div>
    </div>
  </div>

<script>
// ===== 로컬 저장소 헬퍼 =====
const STORE_KEY = 'seats_v1';

function loadStore(){
  try { return JSON.parse(localStorage.getItem(STORE_KEY) || '{}'); }
  catch { return {}; }
}
function saveStore(obj){
  localStorage.setItem(STORE_KEY, JSON.stringify(obj));
}

// 셀 고유키: 학번 있으면 학번, 없으면 이름 사용
function seatKey(cell){
  const id = (cell.querySelector('.id')?.textContent || '').trim();
  const name = (cell.querySelector('.name')?.textContent || '').trim();
  return `seat:${id || name}`;
}

// 셀에 상태 적용
function applyStateToCell(cell, state){
  const reasonEl = cell.querySelector('.reason');
  const nameBtn  = cell.querySelector('.name');
  let cipEl      = cell.querySelector('.cip-result');

  if (!cipEl) {
    cipEl = document.createElement('div');
    cipEl.className = 'cip-result';
    cell.appendChild(cipEl);
  }

  if (reasonEl) reasonEl.textContent = state.reason || '';
  if (nameBtn)  nameBtn.classList.toggle('selected', !!state.selected);
  cell.style.background = state.selected ? '#ffe8e8' : '#fff';
  cipEl.textContent = (state.rounds || []).join(', ');
}

// 전체 복원
function hydrateAll(){
  const store = loadStore();
  document.querySelectorAll('.cell').forEach(cell => {
    const key = seatKey(cell);
    if (store[key]) applyStateToCell(cell, store[key]);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const modal       = document.getElementById('modal');
  const reasonInput = document.getElementById('reasonInput');
  const saveBtn     = document.querySelector('.save-btn');
  const cancelBtn   = document.querySelector('.cancel-btn');
  const hall        = document.getElementById('hall');
  const desk        = document.querySelector('.desk-teacher');

  const cipCheckboxes = () => Array.from(document.querySelectorAll('.cip'));
  let currentCell = null;

  // 초기 복원
  hydrateAll();

  // 이름 클릭 → 모달 열기 (저장으로만 닫힘)
  document.querySelectorAll('.name').forEach(btn => {
    btn.addEventListener('click', () => {
      currentCell = btn.closest('.cell');

      // 사유/차수 복원
      const reasonEl   = currentCell.querySelector('.reason');
      const cipResult  = currentCell.querySelector('.cip-result')?.textContent.trim() || '';
      reasonInput.value = reasonEl ? reasonEl.textContent.trim() : '';

      const savedRounds = cipResult ? cipResult.split(', ').map(s => s.trim()) : [];
      cipCheckboxes().forEach(cb => { cb.checked = savedRounds.includes(cb.value); });

      modal.style.display = 'flex';
      reasonInput.focus();
    });
  });

  // 저장 → 상태 반영 + 저장 + 모달 닫기
  saveBtn.addEventListener('click', () => {
    if (!currentCell) return;

    const text = reasonInput.value.trim();
    const rounds = cipCheckboxes().filter(cb => cb.checked).map(cb => cb.value);

    const state = {
      reason: text,
      rounds,
      selected: text.length > 0
    };

    // 화면 반영
    applyStateToCell(currentCell, state);

    // 저장
    const store = loadStore();
    store[seatKey(currentCell)] = state;
    saveStore(store);

    modal.style.display = 'none';
    currentCell = null;
  });

  // 취소/배경 클릭 무시(저장으로만 닫힘)
  if (cancelBtn) {
    cancelBtn.addEventListener('click', e => e.preventDefault());
  }
  window.addEventListener('click', e => {
    if (e.target === modal) { /* no-op */ }
  });

  // 복도 클릭 → 전체 화면
  if (hall) {
    hall.addEventListener('click', () => {
      const elem = document.documentElement;
      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
    });
  }

  // 교탁 클릭 → 전체 초기화(로컬스토리지 + 화면 상태)
  if (desk) {
    desk.addEventListener('click', () => {
      if (!confirm('정말 전체 초기화할까요?')) return;
      localStorage.removeItem(STORE_KEY);
      document.querySelectorAll('.cell').forEach(cell => {
        const reasonEl = cell.querySelector('.reason');
        const nameBtn  = cell.querySelector('.name');
        const cipEl    = cell.querySelector('.cip-result');

        if (reasonEl) reasonEl.textContent = '';
        if (nameBtn)  nameBtn.classList.remove('selected');
        if (cipEl)    cipEl.textContent = '';
        cell.style.background = '#fff';
      });
    });
  }
});
</script>
</body>
</html>
